\input texinfo.tex
@c %**start of header
@setfilename vicare-openssl.info
@settitle Openssl for Vicare
@c %**end of header

@include version.texi
@include macros.texi

@c page
@c ------------------------------------------------------------
@c Values.
@c ------------------------------------------------------------

@set TITLE                      Openssl for Vicare

@c To be used as @value{PACKAGE} whenever we need to include the full
@c name of this package.
@set PACKAGE                    Vicare/@openssl{}

@c To be used as @value{PACKAGE} whenever we need to include the
@c nickname of the project: the name that is used to compose the
@c distribution tarball or the web address.
@set PACKAGE_NICKNAME           vicare-openssl

@c To be used as @value{AUTHOR} whenever we need to include the list of
@c authors of this document.
@set AUTHOR                     Marco Maggi

@c To be used as @value{AUTHOR_EMAIL} whenever we need to include the
@c email of the *single* author of this document.
@set AUTHOR_EMAIL               @email{marco.maggi.ipsu@@poste.it}

@c To be used as @value{COPYRIGHT_YEARS} whenever we need to include the
@c list of copyright years.
@set COPYRIGHT_YEARS            2013

@c ------------------------------------------------------------

@set FOREIGN_PACKAGE            @openssl{}
@set FOREIGN_VERSION            1.0.1e
@set FOREIGN_URL                @url{http://www.openssl.org/}
@set FOREIGN_SCHEME_LIB         @library{vicare crypto openssl}
@set GITHUB_URL                 @url{http://github.com/marcomaggi/vicare-openssl}
@set DOWNLOAD_URL               @url{http://code.google.com/p/vicare-scheme/downloads/list}
@set DOCUMENTATION_URL          @url{http://marcomaggi.github.com/docs/vicare-openssl.html}


@macro opensslref{NODE, TITLE}
@xref{\NODE\,\TITLE\,\TITLE\,openssl}
@end macro

@macro openssl{}
@acronym{OpenSSL}
@end macro

@c page
@c ------------------------------------------------------------
@c Copyright notice.
@c ------------------------------------------------------------

@copying
This document describes version @version{} of @value{PACKAGE}, a
distribution of C and Scheme libraries for Vicare Scheme, an @rnrs{6}
compliant Scheme implementation; it provides bindings for the
@value{FOREIGN_PACKAGE} C language library.

The package is distributed under the terms of the @gnu{} General Public
License (@gpl{}) and can be downloaded from:

@center @value{DOWNLOAD_URL}

@noindent
development takes place at:

@center @value{GITHUB_URL}

@noindent
@value{FOREIGN_PACKAGE} is available at:

@center @value{FOREIGN_URL}

@noindent
Copyright @copyright{} @value{COPYRIGHT_YEARS} by @value{AUTHOR} @value{AUTHOR_EMAIL}

@quotation
Permission is granted to copy, distribute and/or modify this document
under the terms of the @gnu{} Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with
Invariant Sections being ``@gnu{} Free Documentation License'' and
``@gnu{} General Public License'', no Front--Cover Texts, and no
Back--Cover Texts.  A copy of the license is included in the section
entitled ``@gnu{} Free Documentation License''.
@end quotation
@end copying

@c page
@c ------------------------------------------------------------
@c Headers.
@c ------------------------------------------------------------

@titlepage
@title @value{TITLE}
@subtitle Revision @version{}
@author @value{AUTHOR} @value{AUTHOR_EMAIL}
@page
@vskip 0pt plus 1filll
@insertcopying
@end titlepage

@c ------------------------------------------------------------

@ifinfo
@dircategory Development
@direntry
* vicare-openssl: (vicare-openssl). @value{TITLE}.
@end direntry
@end ifinfo

@c ------------------------------------------------------------

@ignore
@syncodeindex tp cp
@syncodeindex vr cp
@syncodeindex fn cp
@end ignore

@c page
@ifnottex
@node Top
@top @value{TITLE}

@insertcopying

@menu
* overview::                    Overview of the package.
* version::                     Openssl version informations.
* plain::                       Plain programming interface.

Appendices

* Package License::             GNU General Public License.
* Documentation License::       GNU Free Documentation License.
* references::                  Bibliography and references.

Indexes

* concept index::               An entry for each concept.
* function index::              An entry for each function.
* variable index::              An entry for each variable.
* type index::                  An entry for each type.
@end menu
@end ifnottex

@c page
@node overview
@chapter Overview of the package


Vicare Scheme is an @rnrs{6} compliant Scheme language implementation in
the form of a native compiler for x86 architectures, officially
supporting @gnu{}+Linux systems.  @value{PACKAGE} is a distribution of C
language and Scheme language libraries for Vicare Scheme; it provides
bindings for the @value{FOREIGN_PACKAGE} C language library.

The last time the author bothered to update this paragraph, he had
tested @value{FOREIGN_PACKAGE} version @value{FOREIGN_VERSION}; the
@value{FOREIGN_PACKAGE} library is available at:

@center @value{FOREIGN_URL}

The package installs a C language library implementing wrapper C
functions for the C language @value{FOREIGN_PACKAGE} library; on top of
this, the Scheme library @library{vicare crypto openssl} exports one
binding for some @value{FOREIGN_PACKAGE} public functions; additionally
the library @library{vicare crypto openssl constants} exports one
binding for some constant values defined in the C language header
@file{openssl/ssl.h} and others.

The following Scheme libraries are installed:

@table @library
@item vicare crypto openssl
@cindex Library @library{vicare crypto openssl}
@cindex @library{vicare crypto openssl}, library
It exports bindings for some @value{FOREIGN_PACKAGE} public functions.
All the Scheme function names are directly derived from the C function
names by replacing upper case with lower case and underscore characters
@samp{_} with dash characters @samp{-}; so @cfunc{SSL_library_init}
becomes @func{ssl-library-init}.

@item vicare crypto openssl unsafe-capi
@cindex Library @library{vicare crypto openssl unsafe-capi}
@cindex @library{vicare crypto openssl unsafe-capi}, library
It exports syntax bindings for some @value{FOREIGN_PACKAGE} public
functions.  All the Scheme syntax names are directly derived from the C
function names by replacing upper case with lower case and underscore
characters @samp{_} with dash characters @samp{-}; so
@cfunc{SSL_library_init} becomes @func{ssl-library-init}.

These syntaxes expand to a direct call to the C language wrapper
functions in the @value{PACKAGE} library; they are not meant to be
called in normal usage of the package.

@item vicare crypto openssl constants
@cindex Library @library{vicare crypto openssl constants}
@cindex @library{vicare crypto openssl constants}, library
It exports bindings for some constant values defined in the C language
header @file{openssl/ssl.h} and others.

@item vicare crypto openssl features
@cindex Library @library{vicare crypto openssl features}
@cindex @library{vicare crypto openssl features}, library
It exports one identifier syntax binding for each @code{HAVE_} constant
defined by the @command{configure} script, expanding to @true{} or
@false{}.
@end table

Scheme libraries are installed under the directory:

@center @file{$(libdir)/vicare-scheme}

After installation, under the directory:

@center @file{$(libexecdir)/@value{PACKAGE_NICKNAME}}

@noindent
a script @file{compile-all.sps} can be executed to precompile the
installed libraries; for example:

@example
$ sudo vicare \
   --fasl-directory /var/cache/vicare-scheme \
   --compile-dependencies \
      /usr/local/libexec/vicare-openssl/compile-all.sps
@end example

This document contains only a brief description of the functions: refer
to the @value{FOREIGN_PACKAGE}'s documentation for details.

@c page
@node version
@chapter @value{FOREIGN_PACKAGE} version informations


The installed C library follows version numbering as established by the
@gnu{} Autotools.  For an explanation of interface numbers as managed by
@gnu{} Libtool @xref{Libtool versioning, interface, Libtool's versioning
system, libtool, Shared library support for @gnu{}}.

The following bindings are exported by the library
@value{FOREIGN_SCHEME_LIB}.


@defun vicare-openssl-version-interface-current
@defunx vicare-openssl-version-interface-revision
@defunx vicare-openssl-version-interface-age
Return a fixnum representing a version number.
@end defun


@defun vicare-openssl-version
Return a Scheme string representing the version number.
@end defun

@c page
@node plain
@chapter Plain programming interface


@menu
* plain hash::                  Computing hash checksums.
@end menu

@c page
@node plain hash
@section Computing hash checksums


@menu
* plain hash md4::              Computing MD4 hash checksums.
* plain hash md5::              Computing MD5 hash checksums.
* plain hash mdc2::             Computing MDC2 hash checksums.
@end menu

@c page
@node plain hash md4
@subsection Computing MD4 hash checksums


@menu
* plain hash md4 struct::       Hash checksum data structures.
* plain hash md4 api::          Context updating functions.
* plain hash md4 direct::       Directly computing hash checksums.
@end menu

@c page
@node plain hash md4 struct
@subsubsection Hash checksum data structures


The following bindings are exported by the library @library{vicare
crypto openssl}.


@deftp {Struct Type} md4-ctx
@cindex @var{MD4} argument
@cindex Argument @var{MD4}
An opaque Scheme structure holding a pointer object referencing the C
language type @code{MD4_CTX}; it references an MD4 hash checksum
context.

When instances of this type are used as arguments to functions: this
documentation identifies them as @var{MD4}.

There are two categories of @code{md4-ctx} instances: those who own the
underlying checksum context and those who merely reference it.

@itemize
@item
@code{md4-ctx} instances returned by @func{md4-init} do own the context.
When instances of this category are garbage collected or when
@func{md5-final} is applied to them: the context is closed, all the
associated data is finalised; any error is ignored in this procedure.
@end itemize
@end deftp


@defun md4-ctx? @var{obj}
Return @true{} if @var{obj} is an instance of @code{md4-ctx}; otherwise
return @false{}.
@end defun


@defun md4-ctx?/alive @var{obj}
Return @true{} if @var{obj} is an instance of @code{md4-ctx} and the
context it represents is open; otherwise return @false{}.
@end defun


@defun md4-ctx-custom-destructor @var{MD4}
@defunx set-md4-ctx-custom-destructor! @var{MD4} @var{func}
Retrieve or set a destructor function associated to the @var{MD4}.

Whenever the @var{MD4} is closed, either explicitly with
@func{md4-final} or implicitly by the garbage collector, @var{func} is
applied to @var{MD4} before the internal state of @var{MD4} is
finalised.

Notice that @var{func} can do anything, not only destroy some state
associated to @var{MD4}; if we do:

@example
(define context ...)
(set-md4-ctx-custom-destructor! context
  (let ((state (make-some-data-struct)))
    (case-lambda
      ((sex)
       (destroy state))
      (()
       state))))

(let ((state ((md4-ctx-custom-destructor context))))
  (do-something-with context state))
@end example

@noindent
we can easily associate values to @var{MD4}.
@end defun

@c ------------------------------------------------------------

@subsubheading Arguments validation

The following bindings are meant to be used along the library
@library{vicare arguments validation}.


@deffn {Validation Clause} md4-ctx @var{obj}
@deffnx {Validation Clause} false-or-md4-ctx @var{obj}
Succeed if @var{obj} satisfies the predicate @func{md4-ctx?}; the second
clause also accepts @false{}.
@end deffn


@deffn {Validation Clause} md4-ctx/alive @var{obj}
@deffnx {Validation Clause} false-or-md4-ctx/alive @var{obj}
Succeed if @var{obj} satisfies the predicate @func{md4-ctx?/alive}; the
second clause also accepts @false{}.
@end deffn

@c page
@node plain hash md4 api
@subsubsection Context updating functions


The following bindings are exported by the library @library{vicare
crypto openssl}.


@defun md4-init
Allocate and initialise a new instance of @code{md4-ctx}; if successful
return the struct, else return @false{}.  @manpage{MD4_Init, MD4_Init}
@end defun


@defun md4-final @var{MD4}
Finalise a checksum context; if successful return a bytevector holding
the computed checksum, else return @false{}.  @manpage{MD4_Final,
MD4_Final}.  It is fine to apply this function multiple times to the
same @var{MD4} argument.
@end defun


@defun md4-update @var{MD4} @var{input} @var{input.len}
Update the checksum context with the given input data.
@manpage{MD4_Update, MD4_Update}

@var{input} must be a generalised C string, @vicareref{cbuffers strings,
Introduction to generalised C strings}.  When @var{input} is a string:
it is converted to a bytevector with @func{string->utf8}.

The optional @var{input.len} must be @false{} or an exact integer in the
range of the C language type @code{size_t}.  When @var{input} is a
pointer object: @var{input.len} must represent the number of bytes
available in the reference memory block; otherwise @var{input.len} is
ignored.
@end defun

@c page
@node plain hash md4 direct
@subsubsection Directly computing hash checksums


The following bindings are exported by the library @library{vicare
crypto openssl}.


@defun md4 @var{input}
@defunx md4 @var{input} @var{input.len}
Perform a one--step checksum computing; return a bytevector holding the
result.  @manpage{MD4, MD4}.

@var{input} must be a generalised C string, @vicareref{cbuffers strings,
Introduction to generalised C strings}.  When @var{input} is a string:
it is converted to a bytevector with @func{string->utf8}.

The optional @var{input.len} must be @false{} or an exact integer in the
range of the C language type @code{size_t}.  When @var{input} is a
pointer object: @var{input.len} must represent the number of bytes
available in the reference memory block; otherwise @var{input.len} is
ignored.
@end defun

@c page
@node plain hash md5
@subsection Computing MD5 hash checksums


@menu
* plain hash md5 struct::       Hash checksum data structures.
* plain hash md5 api::          Context updating functions.
* plain hash md5 direct::       Directly computing hash checksums.
@end menu

@c page
@node plain hash md5 struct
@subsubsection Hash checksum data structures


The following bindings are exported by the library @library{vicare
crypto openssl}.


@deftp {Struct Type} md5-ctx
@cindex @var{MD5} argument
@cindex Argument @var{MD5}
An opaque Scheme structure holding a pointer object referencing the C
language type @code{MD5_CTX}; it references an MD5 hash checksum
context.

When instances of this type are used as arguments to functions: this
documentation identifies them as @var{MD5}.

There are two categories of @code{md5-ctx} instances: those who own the
underlying checksum context and those who merely reference it.

@itemize
@item
@code{md5-ctx} instances returned by @func{md5-init} do own the context.
When instances of this category are garbage collected or when
@func{md5-final} is applied to them: the context is closed, all the
associated data is finalised; any error is ignored in this procedure.
@end itemize
@end deftp


@defun md5-ctx? @var{obj}
Return @true{} if @var{obj} is an instance of @code{md5-ctx}; otherwise
return @false{}.
@end defun


@defun md5-ctx?/alive @var{obj}
Return @true{} if @var{obj} is an instance of @code{md5-ctx} and the
context it represents is open; otherwise return @false{}.
@end defun


@defun md5-ctx-custom-destructor @var{MD5}
@defunx set-md5-ctx-custom-destructor! @var{MD5} @var{func}
Retrieve or set a destructor function associated to the @var{MD5}.

Whenever the @var{MD5} is closed, either explicitly with
@func{md5-final} or implicitly by the garbage collector, @var{func} is
applied to @var{MD5} before the internal state of @var{MD5} is
finalised.

Notice that @var{func} can do anything, not only destroy some state
associated to @var{MD5}; if we do:

@example
(define context ...)
(set-md5-ctx-custom-destructor! context
  (let ((state (make-some-data-struct)))
    (case-lambda
      ((sex)
       (destroy state))
      (()
       state))))

(let ((state ((md5-ctx-custom-destructor context))))
  (do-something-with context state))
@end example

@noindent
we can easily associate values to @var{MD5}.
@end defun

@c ------------------------------------------------------------

@subsubheading Arguments validation

The following bindings are meant to be used along the library
@library{vicare arguments validation}.


@deffn {Validation Clause} md5-ctx @var{obj}
@deffnx {Validation Clause} false-or-md5-ctx @var{obj}
Succeed if @var{obj} satisfies the predicate @func{md5-ctx?}; the second
clause also accepts @false{}.
@end deffn


@deffn {Validation Clause} md5-ctx/alive @var{obj}
@deffnx {Validation Clause} false-or-md5-ctx/alive @var{obj}
Succeed if @var{obj} satisfies the predicate @func{md5-ctx?/alive}; the
second clause also accepts @false{}.
@end deffn

@c page
@node plain hash md5 api
@subsubsection Context updating functions


The following bindings are exported by the library @library{vicare
crypto openssl}.


@defun md5-init
Allocate and initialise a new instance of @code{md5-ctx}; if successful
return the struct, else return @false{}.  @manpage{MD5_Init, MD5_Init}
@end defun


@defun md5-final @var{MD5}
Finalise a checksum context; if successful return a bytevector holding
the computed checksum, else return @false{}.  @manpage{MD5_Final,
MD5_Final}.  It is fine to apply this function multiple times to the
same @var{MD5} argument.
@end defun


@defun md5-update @var{MD5} @var{input} @var{input.len}
Update the checksum context with the given input data.
@manpage{MD5_Update, MD5_Update}

@var{input} must be a generalised C string, @vicareref{cbuffers strings,
Introduction to generalised C strings}.  When @var{input} is a string:
it is converted to a bytevector with @func{string->utf8}.

The optional @var{input.len} must be @false{} or an exact integer in the
range of the C language type @code{size_t}.  When @var{input} is a
pointer object: @var{input.len} must represent the number of bytes
available in the reference memory block; otherwise @var{input.len} is
ignored.
@end defun

@c page
@node plain hash md5 direct
@subsubsection Directly computing hash checksums


The following bindings are exported by the library @library{vicare
crypto openssl}.


@defun md5 @var{input}
@defunx md5 @var{input} @var{input.len}
Perform a one--step checksum computing; return a bytevector holding the
result.  @manpage{MD5, MD5}.

@var{input} must be a generalised C string, @vicareref{cbuffers strings,
Introduction to generalised C strings}.  When @var{input} is a string:
it is converted to a bytevector with @func{string->utf8}.

The optional @var{input.len} must be @false{} or an exact integer in the
range of the C language type @code{size_t}.  When @var{input} is a
pointer object: @var{input.len} must represent the number of bytes
available in the reference memory block; otherwise @var{input.len} is
ignored.
@end defun

@c page
@node plain hash mdc2
@subsection Computing MDC2 hash checksums


@menu
* plain hash mdc2 struct::       Hash checksum data structures.
* plain hash mdc2 api::          Context updating functions.
* plain hash mdc2 direct::       Directly computing hash checksums.
@end menu

@c page
@node plain hash mdc2 struct
@subsubsection Hash checksum data structures


The following bindings are exported by the library @library{vicare
crypto openssl}.


@deftp {Struct Type} mdc2-ctx
@cindex @var{MDC2} argument
@cindex Argument @var{MDC2}
An opaque Scheme structure holding a pointer object referencing the C
language type @code{MDC2_CTX}; it references an MDC2 hash checksum
context.

When instances of this type are used as arguments to functions: this
documentation identifies them as @var{MDC2}.

There are two categories of @code{mdc2-ctx} instances: those who own the
underlying checksum context and those who merely reference it.

@itemize
@item
@code{mdc2-ctx} instances returned by @func{mdc2-init} do own the context.
When instances of this category are garbage collected or when
@func{mdc2-final} is applied to them: the context is closed, all the
associated data is finalised; any error is ignored in this procedure.
@end itemize
@end deftp


@defun mdc2-ctx? @var{obj}
Return @true{} if @var{obj} is an instance of @code{mdc2-ctx}; otherwise
return @false{}.
@end defun


@defun mdc2-ctx?/alive @var{obj}
Return @true{} if @var{obj} is an instance of @code{mdc2-ctx} and the
context it represents is open; otherwise return @false{}.
@end defun


@defun mdc2-ctx-custom-destructor @var{MDC2}
@defunx set-mdc2-ctx-custom-destructor! @var{MDC2} @var{func}
Retrieve or set a destructor function associated to the @var{MDC2}.

Whenever the @var{MDC2} is closed, either explicitly with
@func{mdc2-final} or implicitly by the garbage collector, @var{func} is
applied to @var{MDC2} before the internal state of @var{MDC2} is
finalised.

Notice that @var{func} can do anything, not only destroy some state
associated to @var{MDC2}; if we do:

@example
(define context ...)
(set-mdc2-ctx-custom-destructor! context
  (let ((state (make-some-data-struct)))
    (case-lambda
      ((sex)
       (destroy state))
      (()
       state))))

(let ((state ((mdc2-ctx-custom-destructor context))))
  (do-something-with context state))
@end example

@noindent
we can easily associate values to @var{MDC2}.
@end defun

@c ------------------------------------------------------------

@subsubheading Arguments validation

The following bindings are meant to be used along the library
@library{vicare arguments validation}.


@deffn {Validation Clause} mdc2-ctx @var{obj}
@deffnx {Validation Clause} false-or-mdc2-ctx @var{obj}
Succeed if @var{obj} satisfies the predicate @func{mdc2-ctx?}; the second
clause also accepts @false{}.
@end deffn


@deffn {Validation Clause} mdc2-ctx/alive @var{obj}
@deffnx {Validation Clause} false-or-mdc2-ctx/alive @var{obj}
Succeed if @var{obj} satisfies the predicate @func{mdc2-ctx?/alive}; the
second clause also accepts @false{}.
@end deffn

@c page
@node plain hash mdc2 api
@subsubsection Context updating functions


The following bindings are exported by the library @library{vicare
crypto openssl}.


@defun mdc2-init
Allocate and initialise a new instance of @code{mdc2-ctx}; if successful
return the struct, else return @false{}.  @manpage{MDC2_Init, MDC2_Init}
@end defun


@defun mdc2-final @var{MDC2}
Finalise a checksum context; if successful return a bytevector holding
the computed checksum, else return @false{}.  @manpage{MDC2_Final,
MDC2_Final}.  It is fine to apply this function multiple times to the
same @var{MDC2} argument.
@end defun


@defun mdc2-update @var{MDC2} @var{input} @var{input.len}
Update the checksum context with the given input data.
@manpage{MDC2_Update, MDC2_Update}

@var{input} must be a generalised C string, @vicareref{cbuffers strings,
Introduction to generalised C strings}.  When @var{input} is a string:
it is converted to a bytevector with @func{string->utf8}.

The optional @var{input.len} must be @false{} or an exact integer in the
range of the C language type @code{size_t}.  When @var{input} is a
pointer object: @var{input.len} must represent the number of bytes
available in the reference memory block; otherwise @var{input.len} is
ignored.
@end defun

@c page
@node plain hash mdc2 direct
@subsubsection Directly computing hash checksums


The following bindings are exported by the library @library{vicare
crypto openssl}.


@defun mdc2 @var{input}
@defunx mdc2 @var{input} @var{input.len}
Perform a one--step checksum computing; return a bytevector holding the
result.  @manpage{MDC2, MDC2}.

@var{input} must be a generalised C string, @vicareref{cbuffers strings,
Introduction to generalised C strings}.  When @var{input} is a string:
it is converted to a bytevector with @func{string->utf8}.

The optional @var{input.len} must be @false{} or an exact integer in the
range of the C language type @code{size_t}.  When @var{input} is a
pointer object: @var{input.len} must represent the number of bytes
available in the reference memory block; otherwise @var{input.len} is
ignored.
@end defun

@c page
@c ------------------------------------------------------------
@c Appendices.
@c ------------------------------------------------------------

@include gpl-3.0.texi
@include fdl-1.3.texi

@c page
@node references
@appendix Bibliography and references


The documentation of @value{PACKAGE} is available online:

@center @value{DOCUMENTATION_URL}

@noindent
the latest version of this package can be downloaded from:

@center @value{DOWNLOAD_URL}

@noindent
development takes place at:

@center @value{GITHUB_URL}

@noindent
the home page of the Vicare project is at:

@center @url{http://marcomaggi.github.com/vicare.html}

@noindent
the home page of the Nausicaa project is at:

@center @url{http://marcomaggi.github.com/nausicaa.html}

@noindent
@value{FOREIGN_PACKAGE} can be found here:

@center @value{FOREIGN_URL}

@c page
@node concept index
@appendix An entry for each concept

@printindex cp

@node function index
@appendix An entry for each function.

@printindex fn

@node variable index
@appendix An entry for each variable.

@printindex vr

@node type index
@appendix An entry for each type.

@printindex tp

@contents
@bye

@c end of file

